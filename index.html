<!DOCTYPE html>
<html>

<head>
    <title>Power Monitor</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding-top: 50px;
        }

        #status-box {
            padding: 50px;
            border-radius: 20px;
            display: inline-block;
            font-size: 2em;
            color: white;
        }

        .online {
            background-color: #27ae60;
        }

        .offline {
            background-color: #c0392b;
        }
    </style>
</head>

<body>
    <h1>Home Power Status</h1>
    <div id="status-box">Connecting...</div>
    <p id="time-text"></p>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDPF0ohJREtl2HK43_q9A7YW5q07_Dp7eM",
            databaseURL: "https://kamble-home-power-monitor-default-rtdb.asia-southeast1.firebasedatabase.app",
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const statusRef = ref(db, 'status/last_seen');

        onValue(statusRef, (snapshot) => {
            const lastSeen = snapshot.val();
            const statusBox = document.getElementById('status-box');
            const timeText = document.getElementById('time-text');

            function updateUI() {
                const now = Date.now();
                const diffSeconds = Math.round((now - lastSeen) / 1000);

                if (diffSeconds < 15) { // If updated in last 90 seconds
                    statusBox.innerText = "GHABRU NAKO LIGHT AHE";
                    statusBox.className = "online";
                } else {
                    statusBox.innerText = "BHoKKAATT bey geli VaPaS llight bsudchi";
                    statusBox.className = "offline";
                }
                timeText.innerText = "Last heartbeat: " + diffSeconds + " seconds ago";
            }

            updateUI();
            setInterval(updateUI, 5000); // Update the "seconds ago" every 5s
        });
    </script>
</body>

</html>